<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Producto</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        .breadcrumb a:hover {
            color: #3483fa;
        }
        .thumbnail-selected {
            border: 2px solid #3483fa;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Breadcrumbs -->
        <div class="text-sm text-gray-600 mb-4 breadcrumb">
            <a href="#" class="hover:text-blue-500">Volver al listado</a> |
            <a href="#" class="hover:text-blue-500">Celulares y Smartphones</a>
        </div>

        <div id="product-card" class="bg-white rounded-lg shadow-md p-6 hidden">
            <!-- Contenedor Principal del Producto (Grid) -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

                <!-- Columna 1: Miniaturas (Thumbnails) -->
                <div class="lg:col-span-1 flex lg:flex-col items-start gap-2 order-2 lg:order-1">
                    <div id="thumbnails" class="flex lg:flex-col gap-2"></div>
                </div>

                <!-- Columna 2: Imagen Principal -->
                <div class="lg:col-span-5 flex justify-center items-start order-1 lg:order-2">
                    <img id="main-image" src="" alt="Imagen principal del producto" class="max-w-full h-auto max-h-[450px] object-contain rounded-lg">
                </div>

                <!-- Columna 3: Título y Características -->
                <div class="lg:col-span-3 order-3">
                    <div>
                        <p class="text-xs text-gray-500 mb-2">Nuevo | <span id="sales-info"></span></p>
                        <h1 id="product-title" class="text-2xl font-semibold text-gray-800 mb-4"></h1>
                        <div class="flex items-center gap-2 my-4">
                            <span id="product-rating" class="text-blue-500 font-semibold"></span>
                            <div id="rating-stars" class="flex text-blue-500"></div>
                            <span id="product-reviews" class="text-sm text-gray-500"></span>
                        </div>
                    </div>
                    <div class="border-t mt-6 pt-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Características del producto</h2>
                        <div id="product-features" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Columna 4: Compra e Información -->
                <div class="lg:col-span-3 order-4">
                    <div class="border border-gray-200 rounded-lg p-6 sticky top-4">
                        <div id="official-store" class="hidden items-center gap-2 text-sm text-blue-500 font-semibold mb-4">
                            <i class="fas fa-store"></i> <span id="store-name"></span>
                        </div>
                        <p class="text-gray-500 text-sm line-through" id="old-price"></p>
                        <div class="flex items-baseline gap-2">
                            <span id="product-price" class="text-3xl font-light text-gray-800"></span>
                            <span id="price-discount" class="text-green-600 font-semibold text-lg"></span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">en 12x <span id="installments"></span></p>

                        <div class="flex items-center gap-2 text-green-600 font-semibold my-4">
                            <i class="fas fa-shipping-fast"></i> <span id="shipping-info"></span>
                        </div>

                        <div class="mb-4">
                            <p class="font-semibold text-sm">Stock disponible</p>
                            <p class="text-sm text-gray-500">Cantidad: <span id="stock-available"></span> disponibles</p>
                        </div>
                        <div class="flex flex-col gap-2">
                            <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-md transition-colors">Comprar ahora</button>
                            <button class="w-full bg-blue-100 hover:bg-blue-200 text-blue-500 font-semibold py-3 rounded-md transition-colors">Agregar al carrito</button>
                        </div>
                        <div class="mt-6 text-sm text-gray-600 space-y-3">
                            <div class="flex gap-3"><i class="fas fa-undo-alt mt-1 text-gray-400"></i><p><span class="text-blue-500">Devolución gratis.</span></p></div>
                            <div class="flex gap-3"><i class="fas fa-shield-alt mt-1 text-gray-400"></i><p><span class="text-blue-500">Compra Protegida.</span></p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Descripción (debajo del grid principal) -->
            <div class="mt-12 border-t pt-8">
                 <h2 class="text-2xl font-semibold text-gray-800 mt-10 mb-4">Descripción</h2>
                 <p id="product-description" class="text-gray-600 leading-relaxed whitespace-pre-line max-w-4xl"></p>
            </div>
        </div>

        <!-- SECCIÓN DE PRODUCTOS RELACIONADOS -->
        <div id="related-products-section" class="mt-12 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Productos relacionados</h2>
            <div id="related-products-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            </div>
        </div>

        <div id="loading-state" class="text-center py-10"><p class="text-lg text-gray-600">Cargando producto...</p></div>
        <div id="error-state" class="text-center py-10 hidden">
             <p class="text-lg text-red-600">Error al cargar el producto.</p>
             <p class="text-sm text-gray-500 mt-2">Asegúrate de que el servidor backend esté funcionando.</p>
        </div>
    </div>

    <script>
        // --- SIMULACIÓN DE API / BASE DE DATOS ---
        const productDatabase = {
          "a55-5g-256gb-azul": { "id": "a55-5g-256gb-azul", "titulo": "Samsung Galaxy A55 5G Dual SIM 256 GB azul oscuro 8 GB RAM", "descripcion": "Con su potente procesador y 8 GB de RAM, este smartphone ofrece un alto rendimiento con una gran velocidad de transmisión de contenido. Con 256 GB de almacenamiento interno, puedes descargar todas tus apps, guardar fotos, videos y series favoritas.", "precio": 439, "precio_anterior": 499, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_900893-MCO75048644633_032024-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_741969-MCO75048644631_032024-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_833228-MCO75048644632_032024-F.webp"], "metodos_pago": ["Visa", "Mastercard", "American Express", "OCA Blue"], "vendedor": { "nombre": "Samsung", "tienda_oficial": true, "ventas": "+500", "calificacion": 4.8 }, "stock": 50, "caracteristicas": { "pantalla": "6.6 pulgadas", "memoria_ram": "8 GB", "almacenamiento": "256 GB", "camara_frontal": "32 MP", "camara_trasera": "50 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.6, "total_reviews": 795 },
          "samsung-galaxy-a34-5g": { "id": "samsung-galaxy-a34-5g", "titulo": "Samsung Galaxy A34 5G 256GB Awesome Violet 8GB RAM", "descripcion": "La pantalla Super AMOLED de 1000 nits del Galaxy A34 5G garantiza una visualización nítida, incluso en exteriores. Para una visualización suave y sedosa en la increíble pantalla de 6,6 pulgadas, las frecuencias de actualización de hasta 120 Hz le dan vida a tu contenido.", "precio": 421, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_866755-MLU75051216817_032024-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_982279-MLU75051216818_032024-F.webp"], "metodos_pago": ["Visa", "Mastercard"], "vendedor": { "nombre": "Samsung", "tienda_oficial": true, "ventas": "+200", "calificacion": 4.7 }, "stock": 30, "caracteristicas": { "pantalla": "6.6 pulgadas", "memoria_ram": "8 GB", "almacenamiento": "256 GB", "camara_frontal": "13 MP", "camara_trasera": "48 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.7, "total_reviews": 512 },
          "motorola-edge-30-fusion": { "id": "motorola-edge-30-fusion", "titulo": "Motorola Edge 30 Fusion 256GB Gris 12GB RAM", "descripcion": "Diseño increíblemente delgado y liviano que se adapta a tu mano. Disfruta de la pantalla pOLED de 6.55” y 144 Hz que te brinda una experiencia visual cinematográfica. Además, obtén un desempeño ultrapotente gracias al procesador Snapdragon® 888+ 5G.", "precio": 419, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_798928-MLU72637029517_112023-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_989233-MLU72637029515_112023-F.webp"], "metodos_pago": ["Visa", "Mastercard", "OCA Blue"], "vendedor": { "nombre": "Motorola", "tienda_oficial": true, "ventas": "+100", "calificacion": 4.9 }, "stock": 15, "caracteristicas": { "pantalla": "6.55 pulgadas", "memoria_ram": "12 GB", "almacenamiento": "256 GB", "camara_frontal": "32 MP", "camara_trasera": "50 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.9, "total_reviews": 320 },
          "xiaomi-redmi-note-12-pro": { "id": "xiaomi-redmi-note-12-pro", "titulo": "Xiaomi Redmi Note 12 Pro 256GB Negro 8GB RAM", "descripcion": "El sistema de cámara más potente de Redmi Note cuenta con un sensor de imagen de gran tamaño y resolución ultraalta de 200 MP con OIS y lente de 7P. Si a esto le sumamos algoritmos de última generación y mucho más, esta cámara te ofrece el máximo poder para crear.", "precio": 326, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_969842-MLU72937963993_112023-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_911290-MLU72937963992_112023-F.webp"], "metodos_pago": ["Visa", "Mastercard"], "vendedor": { "nombre": "Xiaomi", "tienda_oficial": true, "ventas": "+1000", "calificacion": 4.5 }, "stock": 80, "caracteristicas": { "pantalla": "6.67 pulgadas", "memoria_ram": "8 GB", "almacenamiento": "256 GB", "camara_frontal": "16 MP", "camara_trasera": "50 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.5, "total_reviews": 1250 }
        };

        // Función para simular la llamada a `GET /producto/{id}`
        function fetchProductById(productId) {
            return fetch(`http://localhost:8080/producto/${productId}`).then(res => res.json());
            //return Promise.resolve(productDatabase[productId]);
        }

        // Función para simular la llamada a `GET /producto/listAll`
        function fetchAllProducts() {
            return fetch('http://localhost:8080/producto/listAll').then(res => res.json());
            //return Promise.resolve(productDatabase);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || "a55-5g-256gb-azul";

            const productCard = document.getElementById('product-card');
            const loadingState = document.getElementById('loading-state');
            const errorState = document.getElementById('error-state');

            try {
                // Cargar el producto principal y todos los productos en paralelo
                const [product, allProducts] = await Promise.all([
                    fetchProductById(productId),
                    fetchAllProducts()
                ]);

                if (!product) throw new Error("Producto no encontrado");

                renderProduct(product);
                renderRelatedProducts(allProducts, productId);

                loadingState.classList.add('hidden');
                productCard.classList.remove('hidden');

            } catch (error) {
                console.error("Error al cargar los datos:", error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
            }
        });

        function renderProduct(product) {
            // --- Llenar datos del producto ---
            document.title = product.titulo;
            document.getElementById('product-title').textContent = product.titulo;
            document.getElementById('product-description').textContent = product.descripcion;
            document.getElementById('sales-info').textContent = `${product.vendedor.ventas} vendidos`;
            document.getElementById('product-rating').textContent = product.valoracion;
            document.getElementById('product-reviews').textContent = `(${product.total_reviews} opiniones)`;

            // Precio y descuento
            const price = new Intl.NumberFormat('es-UY').format(product.precio);
            document.getElementById('product-price').textContent = `${product.moneda} ${price}`;
            const oldPriceEl = document.getElementById('old-price');
            const discountEl = document.getElementById('price-discount');
            if (product.precio_anterior && product.precio_anterior > product.precio) {
                oldPriceEl.textContent = `${product.moneda} ${new Intl.NumberFormat('es-UY').format(product.precio_anterior)}`;
                const discount = Math.round(((product.precio_anterior - product.precio) / product.precio_anterior) * 100);
                discountEl.textContent = `${discount}% OFF`;
                [oldPriceEl, discountEl].forEach(el => el.classList.remove('hidden'));
            } else {
                [oldPriceEl, discountEl].forEach(el => el.classList.add('hidden'));
            }
            const installmentPrice = new Intl.NumberFormat('es-UY', { style: 'currency', currency: 'USD' }).format(product.precio / 12);
            document.getElementById('installments').textContent = `${installmentPrice.replace('USD', 'U$S')} sin interés`;

            // Info de envío y stock
            document.getElementById('shipping-info').textContent = product.envio_gratis ? "Envío gratis" : "Calcular costo";
            document.getElementById('stock-available').textContent = product.stock;

            // Vendedor
            if (product.vendedor.tienda_oficial) {
                document.getElementById('official-store').classList.remove('hidden');
                document.getElementById('store-name').textContent = `Tienda oficial de ${product.vendedor.nombre}`;
            }

            // Galería de imágenes
            const mainImage = document.getElementById('main-image');
            const thumbnailsContainer = document.getElementById('thumbnails');
            thumbnailsContainer.innerHTML = '';
            mainImage.src = product.imagenes[0];
            product.imagenes.forEach((imgUrl, index) => {
                const thumbContainer = document.createElement('div');
                thumbContainer.className = 'w-12 h-12 p-1 border border-gray-300 rounded-md cursor-pointer hover:border-blue-500 transition-all';
                if (index === 0) thumbContainer.classList.add('thumbnail-selected');
                thumbContainer.innerHTML = `<img src="${imgUrl}" alt="Miniatura ${index + 1}" class="w-full h-full object-contain">`;
                thumbContainer.addEventListener('click', () => {
                    mainImage.src = imgUrl;
                    document.querySelectorAll('#thumbnails > div').forEach(t => t.classList.remove('thumbnail-selected'));
                    thumbContainer.classList.add('thumbnail-selected');
                });
                thumbnailsContainer.appendChild(thumbContainer);
            });

            // Características
            const featuresContainer = document.getElementById('product-features');
            featuresContainer.innerHTML = '';
            for (const [key, value] of Object.entries(product.caracteristicas)) {
                const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                featuresContainer.innerHTML += `<div class="flex justify-between text-sm"><strong class="text-gray-600">${formattedKey}</strong> <span class="text-gray-500">${value === true ? 'Sí' : value}</span></div>`;
            }
        }

        function renderRelatedProducts(allProducts, currentProductId) {
            const relatedGrid = document.getElementById('related-products-grid');
            relatedGrid.innerHTML = '';

            for (const productId in allProducts) {
                if (productId === currentProductId) continue; // No mostrar el producto actual

                const product = allProducts[productId];
                const cardLink = document.createElement('a');
                cardLink.href = `?id=${product.id}`;
                cardLink.className = 'bg-white rounded-lg shadow-sm p-4 flex flex-col hover:shadow-xl transition-shadow duration-300 border';

                cardLink.innerHTML = `
                    <img src="${product.imagenes[0]}" alt="${product.titulo}" class="w-full h-40 object-contain mb-4 border-b pb-4">
                    <p class="text-sm text-gray-600 flex-grow">${product.titulo}</p>
                    <p class="text-xl font-light text-gray-900 mt-2">${product.moneda} ${new Intl.NumberFormat('es-UY').format(product.precio)}</p>
                `;
                relatedGrid.appendChild(cardLink);
            }
            document.getElementById('related-products-section').classList.remove('hidden');
        }
    </script>

</body>
</html>
