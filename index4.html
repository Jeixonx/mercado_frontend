<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Producto</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        .breadcrumb a:hover {
            color: #3483fa;
        }
        .thumbnail-selected {
            border: 2px solid #3483fa;
        }
        /* Estilos para la barra de reputación */
        .reputation-bar-segment {
            height: 8px;
            width: 20%; /* 100% / 5 segmentos */
            border-radius: 2px;
            margin-right: 2px; /* Pequeño espacio entre segmentos */
            /* Colores base muy claros para los segmentos no resaltados */
        }
        .reputation-bar-segment.reputation-level-1 { background-color: rgba(239, 68, 68, 0.2); /* red-500 con 20% opacidad */ }
        .reputation-bar-segment.reputation-level-2 { background-color: rgba(249, 115, 22, 0.2); /* orange-500 con 20% opacidad */ }
        .reputation-bar-segment.reputation-level-3 { background-color: rgba(245, 158, 11, 0.2); /* yellow-500 con 20% opacidad */ }
        .reputation-bar-segment.reputation-level-4 { background-color: rgba(132, 204, 22, 0.2); /* lime-500 con 20% opacidad */ }
        .reputation-bar-segment.reputation-level-5 { background-color: rgba(34, 197, 94, 0.2); /* green-500 con 20% opacidad */ }

        .reputation-bar-segment:last-child {
            margin-right: 0;
        }
        /* Colores para el segmento resaltado */
        .reputation-level-1.highlighted { background-color: #ef4444; /* red-500 */ }
        .reputation-level-2.highlighted { background-color: #f97316; /* orange-500 */ }
        .reputation-level-3.highlighted { background-color: #f59e0b; /* yellow-500 */ }
        .reputation-level-4.highlighted { background-color: #84cc16; /* lime-500 (light green) */ }
        .reputation-level-5.highlighted { background-color: #22c55e; /* green-500 */ }

        /* Colores para iconos de reputación */
        .icon-green { color: #22c55e; /* green-500 */ }
        .icon-red { color: #ef4444; /* red-500 */ }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Breadcrumbs -->
        <div class="text-sm text-gray-600 mb-4 breadcrumb">
            <a href="#" class="hover:text-blue-500">Volver al listado</a> |
            <a href="#" class="hover:text-blue-500">Celulares y Smartphones</a>
        </div>

        <div id="product-card" class="bg-white rounded-lg shadow-md p-6 hidden">
            <!-- Contenedor Principal del Producto (Grid) -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

                <!-- Columna 1: Miniaturas (Thumbnails) -->
                <div class="lg:col-span-1 flex lg:flex-col items-start gap-2 order-2 lg:order-1">
                    <div id="thumbnails" class="flex lg:flex-col gap-2"></div>
                </div>

                <!-- Columna 2: Imagen Principal -->
                <div class="lg:col-span-5 flex justify-center items-start order-1 lg:order-2">
                    <img id="main-image" src="" alt="Imagen principal del producto" class="max-w-full h-auto max-h-[450px] object-contain rounded-lg">
                </div>

                <!-- Columna 3: Título y Características -->
                <div class="lg:col-span-3 order-3">
                    <div>
                        <p class="text-xs text-gray-500 mb-2">Nuevo | <span id="sales-info"></span></p>
                        <h1 id="product-title" class="text-2xl font-semibold text-gray-800 mb-4"></h1>
                        <div class="flex items-center gap-2 my-4">
                            <span id="product-rating" class="text-blue-500 font-semibold"></span>
                            <div id="rating-stars" class="flex text-blue-500"></div>
                            <span id="product-reviews" class="text-sm text-gray-500"></span>
                        </div>
                    </div>
                    <div class="border-t mt-6 pt-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Características del producto</h2>
                        <div id="product-features" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Columna 4: Compra e Información -->
                <div class="lg:col-span-3 order-4">
                    <div class="border border-gray-200 rounded-lg p-6"> <!-- Removed sticky top-4 -->
                        <div id="seller-info-section" class="mb-4">
                            <div id="official-store" class="hidden items-center gap-2 text-sm text-blue-500 font-semibold mb-2">
                                <i class="fas fa-store"></i> <span id="store-name"></span>
                            </div>
                            <div id="seller-profile" class="flex items-center gap-3">
                                <img id="seller-image" src="" alt="Imagen de perfil del vendedor" class="w-10 h-10 rounded-md border object-cover hidden">
                                <div>
                                    <p id="seller-name-display" class="font-semibold text-gray-800"></p>
                                    <p id="seller-sales-count" class="text-sm text-gray-500"></p>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-500 text-sm line-through" id="old-price"></p>
                        <div class="flex items-baseline gap-2">
                            <span id="product-price" class="text-3xl font-light text-gray-800"></span>
                            <span id="price-discount" class="text-green-600 font-semibold text-lg"></span>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">en 12x <span id="installments"></span></p>

                        <div class="flex items-center gap-2 text-green-600 font-semibold my-4">
                            <i class="fas fa-shipping-fast"></i> <span id="shipping-info"></span>
                        </div>

                        <div class="mb-4">
                            <p class="font-semibold text-sm">Stock disponible</p>
                            <p class="text-sm text-gray-500">Cantidad: <span id="stock-available"></span> disponibles</p>
                        </div>
                        <div class="flex flex-col gap-2">
                            <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-md transition-colors">Comprar ahora</button>
                            <button class="w-full bg-blue-100 hover:bg-blue-200 text-blue-500 font-semibold py-3 rounded-md transition-colors">Agregar al carrito</button>
                        </div>
                        <div class="mt-6 text-sm text-gray-600 space-y-3">
                            <div class="flex gap-3"><i class="fas fa-undo-alt mt-1 text-gray-400"></i><p><span class="text-blue-500">Devolución gratis.</span></p></div>
                            <div class="flex gap-3"><i class="fas fa-shield-alt mt-1 text-gray-400"></i><p><span class="text-blue-500">Compra Protegida.</span></p></div>
                        </div>
                    </div>

                    <!-- Nuevo cuadro de información del vendedor (fuera del cuadro de compra) -->
                    <div id="seller-details-box" class="mt-6 border border-gray-200 rounded-lg p-4">
                        <div id="seller-cover-image-container" class="w-full h-24 overflow-hidden rounded-md mb-3 hidden">
                            <img id="seller-cover-image" src="" alt="Imagen de portada del vendedor" class="w-full h-full object-cover">
                        </div>
                        <div class="relative -mt-8 ml-3 flex flex-col items-start"> <!-- Ajustado -mt-8 para w-16 h-16, y flex-col para el texto debajo -->
                            <img id="seller-details-image" src="" alt="Imagen de perfil del vendedor" class="w-16 h-16 rounded-md border-2 border-white object-contain shadow-md hidden">
                            <div class="mt-2"> <!-- Contenedor para nombre y productos, ahora debajo de la imagen -->
                                <p id="seller-details-name" class="font-semibold text-gray-800 text-lg"></p>
                                <p id="seller-details-products-count" class="text-sm text-gray-500"></p>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 mb-4">
                            <p class="text-sm text-gray-600">Reputación del vendedor:</p>
                            <div id="reputation-bar" class="flex w-full">
                                <!-- Los segmentos de la barra de reputación se renderizarán aquí -->
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <p class="font-semibold text-gray-800 text-lg" id="seller-details-sales-count-bottom"></p>
                                <p class="text-sm text-gray-500">Ventas concretadas</p>
                            </div>
                            <div>
                                <i id="attention-icon" class="fas text-xl mb-1"></i>
                                <p class="text-sm text-gray-500" id="attention-level-text"></p>
                            </div>
                            <div>
                                <i id="delivery-icon" class="fas text-xl mb-1"></i>
                                <p class="text-sm text-gray-500" id="delivery-time-text"></p>
                            </div>
                        </div>
                        <button id="view-seller-products-btn" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-500 font-semibold py-3 rounded-md transition-colors mt-4">Ver más productos del vendedor</button>
                    </div>
                    <!-- Fin del nuevo cuadro de información del vendedor -->

                </div>
            </div>

            <!-- Descripción (debajo del grid principal) -->
            <div class="mt-12 border-t pt-8">
                   <h2 class="text-2xl font-semibold text-gray-800 mt-10 mb-4">Descripción</h2>
                   <p id="product-description" class="text-gray-600 leading-relaxed whitespace-pre-line max-w-4xl"></p>
            </div>
        </div>

        <!-- SECCIÓN DE PRODUCTOS RELACIONADOS -->
        <div id="related-products-section" class="mt-12 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Productos relacionados</h2>
            <div id="related-products-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            </div>
        </div>

        <!-- SECCIÓN DE PRODUCTOS DEL VENDEDOR -->
        <div id="seller-products-section" class="mt-12 hidden">
            <h2 id="seller-products-title" class="text-2xl font-semibold text-gray-800 mb-6"></h2>
            <div id="seller-products-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
            </div>
        </div>

        <div id="loading-state" class="text-center py-10"><p class="text-lg text-gray-600">Cargando producto...</p></div>
        <div id="error-state" class="text-center py-10 hidden">
               <p class="text-lg text-red-600">Error al cargar el producto.</p>
               <p class="text-sm text-gray-500 mt-2">Asegúrate de que el servidor backend esté funcionando.</p>
        </div>
    </div>

    <script>
        // --- SIMULACIÓN DE API / BASE DE DATOS (para desarrollo local si el backend no está corriendo) ---
        const productDatabase = {
          "a55-5g-256gb-azul": { "id": "a55-5g-256gb-azul", "titulo": "Samsung Galaxy A55 5G Dual SIM 256 GB azul oscuro 8 GB RAM", "descripcion": "Con su potente procesador y 8 GB de RAM, este smartphone ofrece un alto rendimiento con una gran velocidad de transmisión de contenido. Con 256 GB de almacenamiento interno, puedes descargar todas tus apps, guardar fotos, videos y series favoritas.", "precio": 439, "precio_anterior": 499, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_900893-MCO75048644633_032024-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_741969-MCO75048644631_032024-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_833228-MCO75048644632_032024-F.webp"], "vendedor_id": "samsung_oficial", "stock": 50, "caracteristicas": { "pantalla": "6.6 pulgadas", "memoria_ram": "8 GB", "almacenamiento": "256 GB", "camara_frontal": "32 MP", "camara_trasera": "50 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.6, "total_reviews": 795 },
          "samsung-galaxy-a34-5g": { "id": "samsung-galaxy-a34-5g", "titulo": "Samsung Galaxy A34 5G 256GB Awesome Violet 8GB RAM", "descripcion": "La pantalla Super AMOLED de 1000 nits del Galaxy A34 5G garantiza una visualización nítida, incluso en exteriores. Para una visualización suave y sedosa en la increíble pantalla de 6,6 pulgadas, las frecuencias de actualización de hasta 120 Hz le dan vida a tu contenido.", "precio": 421, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_866755-MLU75051216817_032024-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_982279-MLU75051216818_032024-F.webp"], "vendedor_id": "samsung_oficial", "stock": 30, "caracteristicas": { "pantalla": "6.6 pulgadas", "memoria_ram": "8 GB", "almacenamiento": "256 GB", "camara_frontal": "13 MP", "camara_trasera": "48 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.7, "total_reviews": 512 },
          "motorola-edge-30-fusion": { "id": "motorola-edge-30-fusion", "titulo": "Motorola Edge 30 Fusion 256GB Gris 12GB RAM", "descripcion": "Diseño increíblemente delgado y liviano que se adapta a tu mano. Disfruta de la pantalla pOLED de 6.55” y 144 Hz que te brinda una experiencia visual cinematográfica. Además, obtén un desempeño ultrapotente gracias al procesador Snapdragon® 888+ 5G.", "precio": 419, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_798928-MLU72637029517_112023-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_989233-MLU72637029515_112023-F.webp"], "vendedor_id": "motorola_oficial", "stock": 15, "caracteristicas": { "pantalla": "6.55 pulgadas", "memoria_ram": "12 GB", "almacenamiento": "256 GB", "camara_frontal": "32 MP", "camara_trasera": "50 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.9, "total_reviews": 320 },
          "xiaomi-redmi-note-12-pro": { "id": "xiaomi-redmi-note-12-pro", "titulo": "Xiaomi Redmi Note 12 Pro 256GB Negro 8GB RAM", "descripcion": "El sistema de cámara más potente de Redmi Note cuenta con un sensor de imagen de gran tamaño y resolución ultraalta de 200 MP con OIS y lente de 7P. Si a esto le sumamos algoritmos de última generación y mucho más, esta cámara te ofrece el máximo poder para crear.", "precio": 326, "moneda": "U$S", "imagenes": ["https://http2.mlstatic.com/D_NQ_NP_2X_969842-MLU72937963993_112023-F.webp", "https://http2.mlstatic.com/D_NQ_NP_2X_911290-MLU72937963992_112023-F.webp"], "vendedor_id": "xiaomi_oficial", "stock": 80, "caracteristicas": { "pantalla": "6.67 pulgadas", "memoria_ram": "8 GB", "camara_frontal": "16 MP", "camara_trasera": "50 MP", "nfc": true, "lector_huellas": true }, "envio_gratis": true, "valoracion": 4.5, "total_reviews": 1250 }
        };

        const sellerDatabase = {
          "samsung_oficial": {
            "id": "samsung_oficial",
            "nombre": "Samsung",
            "imagen_perfil": "https://http2.mlstatic.com/D_NQ_NP_626832-MLA48490956557_122021-O.webp",
            "imagen_portada": "https://http2.mlstatic.com/storage/official-stores-images/samsung/background_home_1807.jpg",
            "tienda_oficial": true,
            "ventas_concretadas": 12540,
            "cantidad_productos": 57,
            "reputacion": {
              "nivel": 5,
              "entrega_a_tiempo": true
            }
          },
          "motorola_oficial": {
            "id": "motorola_oficial",
            "nombre": "Motorola",
            "imagen_perfil": "https://http2.mlstatic.com/D_NQ_NP_977864-MLA48490956568_122021-O.webp",
            "imagen_portada": "https://http2.mlstatic.com/storage/official-stores-images/motorola/background_home_0308.jpg",
            "tienda_oficial": true,
            "ventas_concretadas": 8750,
            "cantidad_productos": 34,
            "reputacion": {
              "nivel": 3,
              "entrega_a_tiempo": true
            }
          },
          "xiaomi_oficial": {
            "id": "xiaomi_oficial",
            "nombre": "Xiaomi",
            "imagen_perfil": "https://http2.mlstatic.com/D_NQ_NP_801925-MLA48490956570_122021-O.webp",
            "imagen_portada": "https://http2.mlstatic.com/storage/official-stores-images/xiaomi/background_home_2507.jpg",
            "tienda_oficial": true,
            "ventas_concretadas": 21300,
            "cantidad_productos": 101,
            "reputacion": {
              "nivel": 4,
              "entrega_a_tiempo": false
            }
          }
        };

        // Función para simular la llamada a `GET /producto/{id}`
        function fetchProductById(productId) {
            // Descomenta la línea de abajo y comenta la línea de Promise.resolve para usar un servidor backend
            return fetch(`http://localhost:8080/producto/${productId}`).then(res => res.json());
            // return Promise.resolve(productDatabase[productId]); // Para desarrollo local
        }

        // Función para simular la llamada a `GET /producto/listAll`
        function fetchAllProducts() {
            // Descomenta la línea de abajo y comenta la línea de Promise.resolve para usar un servidor backend
            return fetch('http://localhost:8080/producto/listAll').then(res => res.json());
            // return Promise.resolve(productDatabase); // Para desarrollo local
        }

        // Función para simular la llamada a `GET /vendedor/{id}`
        function fetchSellerById(sellerId) {
            // Descomenta la línea de abajo y comenta la línea de Promise.resolve para usar un servidor backend
            return fetch(`http://localhost:8080/vendedor/${sellerId}`).then(res => res.json());
            // return Promise.resolve(sellerDatabase[sellerId]); // Para desarrollo local
        }

        // Función para simular la llamada a `GET /vendedor/listAll`
        function fetchAllSellers() {
            // Descomenta la línea de abajo y comenta la línea de Promise.resolve para usar un servidor backend
            return fetch('http://localhost:8080/vendedor/listAll').then(res => res.json());
            // return Promise.resolve(sellerDatabase); // Para desarrollo local
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || "a55-5g-256gb-azul";

            const productCard = document.getElementById('product-card');
            const loadingState = document.getElementById('loading-state');
            const errorState = document.getElementById('error-state');

            try {
                // Cargar el producto principal y todos los productos y vendedores en paralelo
                const [product, allProducts, allSellers] = await Promise.all([
                    fetchProductById(productId),
                    fetchAllProducts(),
                    fetchAllSellers()
                ]);

                if (!product) throw new Error("Producto no encontrado");

                const seller = allSellers[product.vendedor_id]; // Obtener los datos del vendedor específico

                renderProduct(product, seller);
                renderRelatedProducts(allProducts, productId);
                renderSellerProducts(allProducts, productId, product.vendedor_id, seller ? seller.nombre : 'Vendedor');

                loadingState.classList.add('hidden');
                productCard.classList.remove('hidden');

            } catch (error) {
                console.error("Error al cargar los datos:", error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
            }
        });

        function renderProduct(product, seller) {
            // --- Llenar datos del producto ---
            document.title = product.titulo;
            document.getElementById('product-title').textContent = product.titulo;
            document.getElementById('product-description').textContent = product.descripcion;
            
            // Información de ventas y vendedor (parte superior)
            if (seller && seller.ventas_concretadas) {
                document.getElementById('sales-info').textContent = `${seller.ventas_concretadas} vendidos`;
            } else {
                document.getElementById('sales-info').textContent = ''; // Limpiar si no hay info de ventas
            }
            
            document.getElementById('product-rating').textContent = product.valoracion;
            document.getElementById('product-reviews').textContent = `(${product.total_reviews} opiniones)`;

            // Renderizar estrellas según la valoración
            const ratingStarsContainer = document.getElementById('rating-stars');
            ratingStarsContainer.innerHTML = '';
            const fullStars = Math.floor(product.valoracion);
            const hasHalfStar = product.valoracion % 1 !== 0;

            for (let i = 0; i < fullStars; i++) {
                const star = document.createElement('i');
                star.className = 'fas fa-star';
                ratingStarsContainer.appendChild(star);
            }
            if (hasHalfStar) {
                const halfStar = document.createElement('i');
                halfStar.className = 'fas fa-star-half-alt';
                ratingStarsContainer.appendChild(halfStar);
            }
            // Rellenar las estrellas restantes con estrellas vacías hasta 5
            for (let i = ratingStarsContainer.children.length; i < 5; i++) {
                const emptyStar = document.createElement('i');
                emptyStar.className = 'far fa-star'; // far para estrella vacía
                ratingStarsContainer.appendChild(emptyStar);
            }

            // Precio y descuento
            const price = new Intl.NumberFormat('es-UY').format(product.precio);
            document.getElementById('product-price').textContent = `${product.moneda} ${price}`;
            const oldPriceEl = document.getElementById('old-price');
            const discountEl = document.getElementById('price-discount');
            if (product.precio_anterior && product.precio_anterior > product.precio) {
                oldPriceEl.textContent = `${product.moneda} ${new Intl.NumberFormat('es-UY').format(product.precio_anterior)}`;
                const discount = Math.round(((product.precio_anterior - product.precio) / product.precio_anterior) * 100);
                discountEl.textContent = `${discount}% OFF`;
                [oldPriceEl, discountEl].forEach(el => el.classList.remove('hidden'));
            } else {
                [oldPriceEl, discountEl].forEach(el => el.classList.add('hidden'));
            }
            const installmentPrice = new Intl.NumberFormat('es-UY', { style: 'currency', currency: 'USD' }).format(product.precio / 12);
            document.getElementById('installments').textContent = `${installmentPrice.replace('USD', 'U$S')} sin interés`;

            // Info de envío y stock
            document.getElementById('shipping-info').textContent = product.envio_gratis ? "Envío gratis" : "Calcular costo";
            document.getElementById('stock-available').textContent = product.stock;

            // Información del vendedor (sección superior)
            const officialStoreEl = document.getElementById('official-store');
            const sellerImageEl = document.getElementById('seller-image'); // Imagen de perfil pequeña
            const sellerNameDisplayEl = document.getElementById('seller-name-display');
            const sellerSalesCountEl = document.getElementById('seller-sales-count');

            if (seller) {
                if (seller.tienda_oficial) {
                    officialStoreEl.classList.remove('hidden');
                    officialStoreEl.classList.add('flex');
                    document.getElementById('store-name').textContent = `Tienda oficial de ${seller.nombre}`;
                } else {
                    officialStoreEl.classList.add('hidden');
                    officialStoreEl.classList.remove('flex');
                }

                if (seller.imagen_perfil) {
                    sellerImageEl.src = seller.imagen_perfil;
                    sellerImageEl.classList.remove('hidden');
                } else {
                    sellerImageEl.classList.add('hidden');
                }
                sellerNameDisplayEl.textContent = seller.nombre;
                sellerSalesCountEl.textContent = `${seller.ventas_concretadas} ventas concretadas`;
            } else {
                // Ocultar la sección de información del vendedor si no hay datos
                document.getElementById('seller-info-section').classList.add('hidden');
            }

            // Información detallada del vendedor (nuevo cuadro)
            const sellerDetailsBox = document.getElementById('seller-details-box');
            const sellerCoverImageContainer = document.getElementById('seller-cover-image-container');
            const sellerCoverImage = document.getElementById('seller-cover-image');
            const sellerDetailsImage = document.getElementById('seller-details-image'); // Imagen de perfil grande
            const sellerDetailsName = document.getElementById('seller-details-name');
            const sellerDetailsProductsCount = document.getElementById('seller-details-products-count');
            const sellerDetailsSalesCountBottom = document.getElementById('seller-details-sales-count-bottom');
            const reputationBar = document.getElementById('reputation-bar');
            const attentionIcon = document.getElementById('attention-icon');
            const attentionLevelText = document.getElementById('attention-level-text');
            const deliveryIcon = document.getElementById('delivery-icon');
            const deliveryTimeText = document.getElementById('delivery-time-text');
            const viewSellerProductsBtn = document.getElementById('view-seller-products-btn');

            if (seller) {
                sellerDetailsBox.classList.remove('hidden');
                
                // Imagen de portada
                if (seller.imagen_portada) {
                    sellerCoverImage.src = seller.imagen_portada;
                    sellerCoverImageContainer.classList.remove('hidden');
                } else {
                    sellerCoverImageContainer.classList.add('hidden');
                }

                // Imagen de perfil (cuadrada) y su texto debajo
                const sellerProfileAndTextContainer = sellerDetailsImage.parentElement;
                sellerProfileAndTextContainer.classList.remove('flex', 'items-start', 'gap-3');
                sellerProfileAndTextContainer.classList.add('flex', 'flex-col', 'items-start'); // Alinea el contenido a la izquierda

                if (seller.imagen_perfil) {
                    sellerDetailsImage.src = seller.imagen_perfil;
                    // Changed object-cover to object-contain
                    sellerDetailsImage.classList.remove('hidden', 'object-cover');
                    sellerDetailsImage.classList.add('object-contain');
                } else {
                    sellerDetailsImage.classList.add('hidden');
                }
                sellerDetailsName.textContent = seller.nombre;
                sellerDetailsProductsCount.textContent = `+${seller.cantidad_productos} Productos`;
                sellerDetailsSalesCountBottom.textContent = `+${seller.ventas_concretadas}`;

                reputationBar.innerHTML = ''; // Limpiar la barra antes de renderizar
                const reputationLevels = [
                    { level: 1, colorClass: 'reputation-level-1', attention: 'Brinda mala atención' },
                    { level: 2, colorClass: 'reputation-level-2', attention: 'Brinda mala atención' },
                    { level: 3, colorClass: 'reputation-level-3', attention: 'Brinda regular atención' },
                    { level: 4, colorClass: 'reputation-level-4', attention: 'Brinda buena atención' },
                    { level: 5, colorClass: 'reputation-level-5', attention: 'Brinda buena atención' }
                ];

                for (let i = 0; i < 5; i++) {
                    const segment = document.createElement('div');
                    segment.classList.add('reputation-bar-segment');
                    const levelData = reputationLevels[i];
                    
                    // Aplicar el color base muy tenue a todos los segmentos
                    segment.classList.add(`reputation-level-${i + 1}`);

                    // Resaltar solo el segmento correspondiente al nivel de reputación
                    if (seller.reputacion && seller.reputacion.nivel === (i + 1)) {
                        segment.classList.add('highlighted');
                    }
                    reputationBar.appendChild(segment);
                }

                // Nivel de atención
                if (seller.reputacion) {
                    const currentReputationLevel = reputationLevels[seller.reputacion.nivel - 1];
                    attentionLevelText.textContent = currentReputationLevel.attention;
                    if (seller.reputacion.nivel >= 3) { // Asumiendo que 3, 4, 5 son "buena atención"
                        attentionIcon.className = 'fas fa-comment-dots icon-green text-xl mb-1';
                    } else {
                        attentionIcon.className = 'fas fa-comment-dots icon-red text-xl mb-1';
                    }
                }

                // Entrega a tiempo
                if (seller.reputacion && seller.reputacion.entrega_a_tiempo !== undefined) {
                    if (seller.reputacion.entrega_a_tiempo) {
                        deliveryTimeText.textContent = 'Entrega sus productos a tiempo';
                        deliveryIcon.className = 'fas fa-truck icon-green text-xl mb-1';
                    } else {
                        deliveryTimeText.textContent = 'No entrega sus productos a tiempo';
                        deliveryIcon.className = 'fas fa-truck icon-red text-xl mb-1';
                    }
                }

                // Botón "Ver más productos del vendedor"
                viewSellerProductsBtn.onclick = () => {
                    const sellerProductsSection = document.getElementById('seller-products-section');
                    if (sellerProductsSection) {
                        sellerProductsSection.scrollIntoView({ behavior: 'smooth' });
                    }
                };

            } else {
                sellerDetailsBox.classList.add('hidden');
            }

            // Galería de imágenes
            const mainImage = document.getElementById('main-image');
            const thumbnailsContainer = document.getElementById('thumbnails');
            thumbnailsContainer.innerHTML = '';
            mainImage.src = product.imagenes[0];
            product.imagenes.forEach((imgUrl, index) => {
                const thumbContainer = document.createElement('div');
                thumbContainer.className = 'w-12 h-12 p-1 border border-gray-300 rounded-md cursor-pointer hover:border-blue-500 transition-all';
                if (index === 0) thumbContainer.classList.add('thumbnail-selected');
                thumbContainer.innerHTML = `<img src="${imgUrl}" alt="Miniatura ${index + 1}" class="w-full h-full object-contain">`;
                thumbContainer.addEventListener('click', () => {
                    mainImage.src = imgUrl;
                    document.querySelectorAll('#thumbnails > div').forEach(t => t.classList.remove('thumbnail-selected'));
                    thumbContainer.classList.add('thumbnail-selected');
                });
                thumbnailsContainer.appendChild(thumbContainer);
            });

            // Características
            const featuresContainer = document.getElementById('product-features');
            featuresContainer.innerHTML = '';
            for (const [key, value] of Object.entries(product.caracteristicas)) {
                const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                featuresContainer.innerHTML += `<div class="flex justify-between text-sm"><strong class="text-gray-600">${formattedKey}</strong> <span class="text-gray-500">${value === true ? 'Sí' : value}</span></div>`;
            }
        }

        function renderRelatedProducts(allProducts, currentProductId) {
            const relatedGrid = document.getElementById('related-products-grid');
            relatedGrid.innerHTML = '';

            // Convertir el objeto allProducts a un array y mezclarlo
            const productsArray = Object.values(allProducts);
            const shuffledProducts = productsArray.sort(() => 0.5 - Math.random());

            let count = 0;
            for (const product of shuffledProducts) {
                if (product.id === currentProductId) continue; // No mostrar el producto actual
                if (count >= 5) break; // Limitar a 5 productos relacionados

                const cardLink = document.createElement('a');
                cardLink.href = `?id=${product.id}`;
                cardLink.className = 'bg-white rounded-lg shadow-sm p-4 flex flex-col hover:shadow-xl transition-shadow duration-300 border';

                cardLink.innerHTML = `
                    <img src="${product.imagenes[0]}" alt="${product.titulo}" class="w-full h-40 object-contain mb-4 border-b pb-4">
                    <p class="text-sm text-gray-600 flex-grow">${product.titulo}</p>
                    <p class="text-xl font-light text-gray-900 mt-2">${product.moneda} ${new Intl.NumberFormat('es-UY').format(product.precio)}</p>
                `;
                relatedGrid.appendChild(cardLink);
                count++;
            }
            document.getElementById('related-products-section').classList.remove('hidden');
        }

        function renderSellerProducts(allProducts, currentProductId, currentSellerId, sellerName) {
            const sellerProductsSection = document.getElementById('seller-products-section');
            const sellerProductsTitle = document.getElementById('seller-products-title');
            const sellerProductsGrid = document.getElementById('seller-products-grid');
            sellerProductsGrid.innerHTML = '';

            const productsBySeller = Object.values(allProducts).filter(product => 
                product.vendedor_id === currentSellerId && product.id !== currentProductId
            );

            if (productsBySeller.length > 0) {
                sellerProductsTitle.textContent = `Más productos de ${sellerName}`;
                productsBySeller.slice(0, 5).forEach(product => { // Limitar a 5 productos del vendedor
                    const cardLink = document.createElement('a');
                    cardLink.href = `?id=${product.id}`;
                    cardLink.className = 'bg-white rounded-lg shadow-sm p-4 flex flex-col hover:shadow-xl transition-shadow duration-300 border';

                    cardLink.innerHTML = `
                        <img src="${product.imagenes[0]}" alt="${product.titulo}" class="w-full h-40 object-contain mb-4 border-b pb-4">
                        <p class="text-sm text-gray-600 flex-grow">${product.titulo}</p>
                        <p class="text-xl font-light text-gray-900 mt-2">${product.moneda} ${new Intl.NumberFormat('es-UY').format(product.precio)}</p>
                    `;
                    sellerProductsGrid.appendChild(cardLink);
                });
                sellerProductsSection.classList.remove('hidden');
            } else {
                sellerProductsSection.classList.add('hidden');
            }
        }
    </script>

</body>
</html>
